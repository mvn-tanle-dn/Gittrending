{"ast":null,"code":"import _classCallCheck from \"/Users/minmin/Documents/TuongTacMayTinh-Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/minmin/Documents/TuongTacMayTinh-Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/minmin/Documents/TuongTacMayTinh-Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/minmin/Documents/TuongTacMayTinh-Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"/Users/minmin/Documents/TuongTacMayTinh-Client/src/containers/feed/index.js\";\nimport React from 'react';\nimport moment from 'moment';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport './styles.css';\nimport Alert from '@components/alert';\nimport Loader from '@components/loader';\nimport TopNav from '@components/top-nav';\nimport Filters from '@components/filters';\nimport GroupHeading from '@components/group-heading';\nimport { fetchTrending } from '@redux/github/actions';\nimport RepositoryList from '@components/repository-list';\nimport RepositoryGrid from '@components/repository-grid';\nimport { updateDateJump, updateLanguage, updateViewType } from '@redux/preference/actions';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar FeedContainer = /*#__PURE__*/function (_React$Component) {\n  _inherits(FeedContainer, _React$Component);\n\n  var _super = _createSuper(FeedContainer);\n\n  function FeedContainer() {\n    _classCallCheck(this, FeedContainer);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(FeedContainer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var existingRepositories = this.props.github.repositories || []; // If there are no loaded repositories before, fetch them\n\n      if (existingRepositories.length === 0) {\n        this.fetchNextRepositories();\n      }\n    }\n  }, {\n    key: \"fetchNextRepositories\",\n    value: function fetchNextRepositories() {\n      var filters = this.getFilters();\n      this.props.fetchTrending(filters);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var currPreferences = this.props.preference;\n      var prevPreferences = prevProps.preference; // If language or dateJump has been updated, reload\n      // the repositories\n\n      if (currPreferences.language !== prevPreferences.language || currPreferences.dateJump !== prevPreferences.dateJump) {\n        this.fetchNextRepositories();\n      }\n    }\n  }, {\n    key: \"getFilters\",\n    value: function getFilters() {\n      var filters = {};\n      filters.dateRange = this.getNextDateRange();\n\n      if (this.props.preference.language) {\n        filters.language = this.props.preference.language;\n      }\n\n      if (this.props.preference.options.token) {\n        filters.token = this.props.preference.options.token;\n      }\n\n      return filters;\n    }\n  }, {\n    key: \"getNextDateRange\",\n    value: function getNextDateRange() {\n      var repositories = this.props.github.repositories || [];\n      var dateJump = this.props.preference.dateJump;\n      var dateRange = {};\n      var lastRecords = repositories[repositories.length - 1];\n\n      if (lastRecords) {\n        dateRange.start = moment(lastRecords.start).subtract(1, dateJump).startOf('day');\n        dateRange.end = lastRecords.start;\n      } else {\n        dateRange.start = moment().subtract(1, dateJump).startOf('day');\n        dateRange.end = moment().startOf('day');\n      }\n\n      return dateRange;\n    }\n  }, {\n    key: \"renderTokenWarning\",\n    value: function renderTokenWarning() {\n      return !this.props.preference.options.token && /*#__PURE__*/_jsxDEV(Alert, {\n        type: \"warning\",\n        children: [\"Make sure to\", /*#__PURE__*/_jsxDEV(\"strong\", {\n          className: \"ml-1 mr-1\",\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/options\",\n            children: \"add a token\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 11\n        }, this), \"to avoid hitting the rate limit\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this);\n    }\n  }, {\n    key: \"renderErrors\",\n    value: function renderErrors() {\n      if (!this.props.github.error) {\n        return null;\n      }\n\n      var message = '';\n\n      switch (this.props.github.error.toLowerCase()) {\n        case 'bad credentials':\n          message = /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Token is invalid, try \", /*#__PURE__*/_jsxDEV(Link, {\n              to: \"/options\",\n              children: \"updating the token\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 35\n            }, this), ' ', \"on the options page\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 11\n          }, this);\n          break;\n\n        case 'network error':\n          message = 'Error trying to connect to GitHub servers';\n          break;\n\n        default:\n          message = this.props.github.error;\n          break;\n      }\n\n      return /*#__PURE__*/_jsxDEV(Alert, {\n        type: \"danger\",\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 12\n      }, this);\n    }\n  }, {\n    key: \"renderAlerts\",\n    value: function renderAlerts() {\n      var tokenWarning = this.renderTokenWarning();\n      var error = this.renderErrors();\n\n      if (tokenWarning || error) {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"alert-group\",\n          children: [tokenWarning, error]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 9\n        }, this);\n      }\n\n      return null;\n    }\n  }, {\n    key: \"renderRepositoriesList\",\n    value: function renderRepositoriesList() {\n      if (this.props.preference.viewType === 'grid') {\n        return /*#__PURE__*/_jsxDEV(RepositoryGrid, {\n          repositories: this.props.github.repositories || [],\n          dateJump: this.props.preference.dateJump\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 9\n        }, this);\n      }\n\n      return /*#__PURE__*/_jsxDEV(RepositoryList, {\n        repositories: this.props.github.repositories || [],\n        dateJump: this.props.preference.dateJump\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 7\n      }, this);\n    }\n  }, {\n    key: \"hasRepositories\",\n    value: function hasRepositories() {\n      return this.props.github.repositories && this.props.github.repositories.length !== 0;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this = this;\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page-wrap\",\n        children: [/*#__PURE__*/_jsxDEV(TopNav, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 9\n        }, this), this.renderAlerts(), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container mb-5 pb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header-row clearfix\",\n            children: [this.hasRepositories() && /*#__PURE__*/_jsxDEV(GroupHeading, {\n              start: this.props.github.repositories[0].start,\n              end: this.props.github.repositories[0].end,\n              dateJump: this.props.preference.dateJump\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"group-filters\",\n              children: this.hasRepositories() && /*#__PURE__*/_jsxDEV(Filters, {\n                selectedLanguage: this.props.preference.language,\n                selectedViewType: this.props.preference.viewType,\n                updateLanguage: this.props.updateLanguage,\n                updateViewType: this.props.updateViewType,\n                updateDateJump: this.props.updateDateJump,\n                selectedDateJump: this.props.preference.dateJump\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"body-row\",\n            children: [this.renderRepositoriesList(), this.props.github.processing && /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 46\n            }, this), !this.props.github.processing && this.hasRepositories() && /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-primary shadow load-next-date\",\n              onClick: function onClick() {\n                return _this.fetchNextRepositories();\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"fa fa-refresh mr-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 17\n              }, this), \"Load next \", this.props.preference.dateJump]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return FeedContainer;\n}(React.Component);\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    preference: store.preference,\n    github: store.github\n  };\n};\n\nvar mapDispatchToProps = {\n  updateLanguage: updateLanguage,\n  updateViewType: updateViewType,\n  updateDateJump: updateDateJump,\n  fetchTrending: fetchTrending\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(FeedContainer);","map":{"version":3,"sources":["/Users/minmin/Documents/TuongTacMayTinh-Client/src/containers/feed/index.js"],"names":["React","moment","connect","Link","Alert","Loader","TopNav","Filters","GroupHeading","fetchTrending","RepositoryList","RepositoryGrid","updateDateJump","updateLanguage","updateViewType","FeedContainer","existingRepositories","props","github","repositories","length","fetchNextRepositories","filters","getFilters","prevProps","currPreferences","preference","prevPreferences","language","dateJump","dateRange","getNextDateRange","options","token","lastRecords","start","subtract","startOf","end","error","message","toLowerCase","tokenWarning","renderTokenWarning","renderErrors","viewType","renderAlerts","hasRepositories","renderRepositoriesList","processing","Component","mapStateToProps","store","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport moment from 'moment';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\n\nimport './styles.css';\nimport Alert from '@components/alert';\nimport Loader from '@components/loader';\nimport TopNav from '@components/top-nav';\nimport Filters from '@components/filters';\nimport GroupHeading from '@components/group-heading';\nimport { fetchTrending } from '@redux/github/actions';\nimport RepositoryList from '@components/repository-list';\nimport RepositoryGrid from '@components/repository-grid';\nimport {\n  updateDateJump,\n  updateLanguage,\n  updateViewType,\n} from '@redux/preference/actions';\n\nclass FeedContainer extends React.Component {\n  componentDidMount() {\n    const existingRepositories = this.props.github.repositories || [];\n\n    // If there are no loaded repositories before, fetch them\n    if (existingRepositories.length === 0) {\n      this.fetchNextRepositories();\n    }\n  }\n\n  fetchNextRepositories() {\n    const filters = this.getFilters();\n    this.props.fetchTrending(filters);\n  }\n\n  componentDidUpdate(prevProps) {\n    const currPreferences = this.props.preference;\n    const prevPreferences = prevProps.preference;\n\n    // If language or dateJump has been updated, reload\n    // the repositories\n    if (\n      currPreferences.language !== prevPreferences.language ||\n      currPreferences.dateJump !== prevPreferences.dateJump\n    ) {\n      this.fetchNextRepositories();\n    }\n  }\n\n  getFilters() {\n    const filters = {};\n\n    filters.dateRange = this.getNextDateRange();\n    if (this.props.preference.language) {\n      filters.language = this.props.preference.language;\n    }\n\n    if (this.props.preference.options.token) {\n      filters.token = this.props.preference.options.token;\n    }\n\n    return filters;\n  }\n\n  getNextDateRange() {\n    const repositories = this.props.github.repositories || [];\n    const dateJump = this.props.preference.dateJump;\n\n    const dateRange = {};\n    const lastRecords = repositories[repositories.length - 1];\n\n    if (lastRecords) {\n      dateRange.start = moment(lastRecords.start)\n        .subtract(1, dateJump)\n        .startOf('day');\n      dateRange.end = lastRecords.start;\n    } else {\n      dateRange.start = moment().subtract(1, dateJump).startOf('day');\n      dateRange.end = moment().startOf('day');\n    }\n\n    return dateRange;\n  }\n\n  renderTokenWarning() {\n    return (\n      !this.props.preference.options.token && (\n        <Alert type=\"warning\">\n          Make sure to\n          <strong className=\"ml-1 mr-1\">\n            <Link to=\"/options\">add a token</Link>\n          </strong>\n          to avoid hitting the rate limit\n        </Alert>\n      )\n    );\n  }\n\n  renderErrors() {\n    if (!this.props.github.error) {\n      return null;\n    }\n\n    let message = '';\n    switch (this.props.github.error.toLowerCase()) {\n      case 'bad credentials':\n        message = (\n          <span>\n            Token is invalid, try <Link to=\"/options\">updating the token</Link>{' '}\n            on the options page\n          </span>\n        );\n        break;\n      case 'network error':\n        message = 'Error trying to connect to GitHub servers';\n        break;\n      default:\n        message = this.props.github.error;\n        break;\n    }\n\n    return <Alert type=\"danger\">{message}</Alert>;\n  }\n\n  renderAlerts() {\n    const tokenWarning = this.renderTokenWarning();\n    const error = this.renderErrors();\n\n    if (tokenWarning || error) {\n      return (\n        <div className=\"alert-group\">\n          {tokenWarning}\n          {error}\n        </div>\n      );\n    }\n\n    return null;\n  }\n\n  renderRepositoriesList() {\n    if (this.props.preference.viewType === 'grid') {\n      return (\n        <RepositoryGrid\n          repositories={this.props.github.repositories || []}\n          dateJump={this.props.preference.dateJump}\n        />\n      );\n    }\n\n    return (\n      <RepositoryList\n        repositories={this.props.github.repositories || []}\n        dateJump={this.props.preference.dateJump}\n      />\n    );\n  }\n\n  hasRepositories() {\n    return (\n      this.props.github.repositories &&\n      this.props.github.repositories.length !== 0\n    );\n  }\n\n  render() {\n    return (\n      <div className=\"page-wrap\">\n        <TopNav />\n\n        {this.renderAlerts()}\n\n        <div className=\"container mb-5 pb-4\">\n          <div className=\"header-row clearfix\">\n            {this.hasRepositories() && (\n              <GroupHeading\n                start={this.props.github.repositories[0].start}\n                end={this.props.github.repositories[0].end}\n                dateJump={this.props.preference.dateJump}\n              />\n            )}\n            <div className=\"group-filters\">\n              {this.hasRepositories() && (\n                <Filters\n                  selectedLanguage={this.props.preference.language}\n                  selectedViewType={this.props.preference.viewType}\n                  updateLanguage={this.props.updateLanguage}\n                  updateViewType={this.props.updateViewType}\n                  updateDateJump={this.props.updateDateJump}\n                  selectedDateJump={this.props.preference.dateJump}\n                />\n              )}\n            </div>\n          </div>\n          <div className=\"body-row\">\n            {this.renderRepositoriesList()}\n\n            {this.props.github.processing && <Loader />}\n\n            {!this.props.github.processing && this.hasRepositories() && (\n              <button\n                className=\"btn btn-primary shadow load-next-date\"\n                onClick={() => this.fetchNextRepositories()}\n              >\n                <i className=\"fa fa-refresh mr-2\"></i>\n                Load next {this.props.preference.dateJump}\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (store) => {\n  return {\n    preference: store.preference,\n    github: store.github,\n  };\n};\n\nconst mapDispatchToProps = {\n  updateLanguage,\n  updateViewType,\n  updateDateJump,\n  fetchTrending,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(FeedContainer);\n"]},"metadata":{},"sourceType":"module"}